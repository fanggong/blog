---
title: ggplot2使用笔记（3）——Scales
author: Fang Yongchao
date: "2021-03-24"
output:
  blogdown::html_page:
    toc: yes
    toc_depth: 2
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(ggplot2)
library(dplyr)
```

## Scales

----------------------

### `scale_*_continuous()`：对连续型数据的坐标轴进行修改

- <SCALE_FUNCTION>不会改变数据，仅仅改变坐标轴的结构，如线的密度、顺序等
- **name**：坐标轴名称
- **breaks**：坐标轴主要刻度线，可以为一个向量，也可以是一个函数，函数将**limits**作为输入，输出一个向量作为**breaks**，需要注意如果使用函数输出结果貌似会受到**expand**参数的影响，具体影响不明
- **minor_breaks**：坐标轴次要刻度线，具体同**breaks**
- **labels**：坐标轴各个**break**点的labels，可以为一个向量，也可以是一个函数，函数将**breaks**作为输入，输出一个向量作为**labels**
- **limits**：坐标轴范围，可以是一个长度为2的向量，也可以是一个函数，当前默认的的**limits**作为输入，输出新的**limits**
- **expand**：对当前的坐标轴进行一定程度扩充，用`expand_scale()`对其进行赋值
  - **mult**：上下（左右）各增加当前**limits**的**mult**倍
  - **add**：上下（左右）各增加**add**长度的坐标轴
- **oob**：不明
- **trans**：直接对坐标轴进行变换，有"asn", "atanh", "boxcox", "date", "exp", "hms", "identity", "log", "log10", "log1p", "log2", "logit", "modulus", "probability", "probit", "pseudo_log", "reciprocal", "reverse", "sqrt" 和 "time"
- **position**：坐标轴位置，"left"，"right"，"bottom"或"right"
- **sec.axis**：增加副坐标轴，用`sec.axis()`对其进行赋值
  - **trans**：一个对主坐标进行变换的公式
  - **name**：名称
  - **breaks**：主要刻度线
  - **labels**：标签
- `scale_*_log10()`，`scale_*_reverse()`，`scale_x_sqrt()`提供了三种常见变换的简写
- 通过调整数据和**sec.axis**可以实现excel中的双坐标轴

```{r}
fyc <- tibble(
  Month = c(1:12), 
  Sales = sample(1:12),
  CumSales = cumsum(Sales)
)
ggplot(fyc, aes(Month, Sales)) +
  geom_col(fill = "blue", alpha = 0.3) +
  geom_path(aes(Month, CumSales/5), colour = "darkgreen") +
  geom_point(aes(Month, CumSales/5), colour = "darkgreen") +
  scale_y_continuous(
    breaks = seq(0, 16, 4), minor_breaks = seq(0, 16, 2),
    expand = expand_scale(mult = 0, add = 0.5), limits = c(0, 16),
    sec.axis = sec_axis(trans = ~ 5*., name = "CumSales")
    ) +
  scale_x_continuous(
    breaks = c(1:12), minor_breaks = NULL
  )
```

```{r}
fyc <- tibble(long = 10^(1:10), lat = 1:10)
ggplot(fyc, aes(long, lat)) +
  geom_point() +
  scale_x_log10()
```

```{r}
fyc <- tibble(long = 10:1, lat = 1:10)
ggplot(fyc, aes(long, lat)) +
  geom_point() +
  scale_y_reverse()
```

```{r}
fyc <- tibble(long = (1:10)^2, lat = 1:10)
ggplot(fyc, aes(long, lat)) +
  geom_point() +
  scale_x_sqrt()
```

### `scale_*_discrete()`：对离散型数据的坐标轴进行修改

- **palette**：不明
- **breaks**：用超出数据范围的值来赋值貌似没有意义，当赋的值正好是目前有的值的时候才会显示在坐标轴上
- **limits**：限定坐标轴上得值以及值的顺序
- **drop**：离散数据是factor时，是否舍弃不存在数据的因子
- **na.translate**：是否保留NA
- **na.value**：不明
- **aesthetics**：不明
- **scale_name**：不明
- **name**：坐标轴名称
- **labels**：给每个**breaks**设定坐标轴上的**labels**
- **expand**：对当前的坐标轴进行一定程度扩充，用`expand_scale()`对其进行赋值
  - **mult**：上下（左右）各增加当前**limits**的**mult**倍
  - **add**：上下（左右）各增加**add**长度的坐标轴
  
```{r}
fyc <- tibble(
  Month = rep(c("Q1", "Q2", "Q3", NA), each = 30),
  Sales = sample(1:120)
)
ggplot(fyc, aes(Month, Sales)) +
  geom_boxplot() +
  scale_x_discrete(
    drop = FALSE
  )
```

### `scale_*_date()`、`scale_*_datetime()`和`scale_*_time()`：对时间序列数据的坐标轴进行修改

- **name**：
- **breaks**：
- **date_breaks**：
- **labels**：
- **date_labels**：
- **minor_breaks**：
- **date_minor_breaks**：
- **limits**：
- **expand**：
- **position**：
- **sec.axis**：
- **timezone**：
- **oob**：
- **na.value**：
- 总体上与`scale_*_continuous()`类似，但是每个参数多了一个对应的**data_***参数，可通过一个字符串来表示时间

### `scale_*_brewer()`：离散的颜色或填充

- **name**、**limits**、**breaks**、**labels**
- **type**："seq"(sequential)，"div"(diverging)，"qual"(qualitative)
- **palette**：调色板，用数字或字符串赋值
- **direction**：从**palette**中选取颜色1表示正向，-1表示反向

```{r}
fyc <- tibble(
  Season = sample(c("Q1", "Q2", "Q3"), 1000, replace = TRUE),
  Sales = rnorm(1000)
)
ggplot(fyc, aes(Sales)) +
  geom_histogram(aes(fill = Season), binwidth = 0.1) + 
  scale_fill_brewer(
    type = "seq",
    palette = 1,
    direction = -1
  )
```

```{r}
fyc <- tibble(
  Area = sample(c("east", "west", "north"), 1000, replace = TRUE),
  long = rnorm(1000), lat = rnorm(1000)
)
ggplot(fyc, aes(long, lat)) +
  geom_point(aes(colour = Area)) + 
  scale_color_brewer(
    type = "div",
    palette = 1,
    direction = -1
  )
```

### `scale_*_distiller()`：连续的颜色或填充

- **name**、**limits**、**breaks**、**labels**
- **type**："seq"(sequential)，"div"(diverging)，"qual"(qualitative)
- **palette**：调色板，用数字或字符串赋值
- **direction**：从**palette**中选取颜色1表示正向，-1表示反向

```{r}
fyc <- tibble(
  long = rep(1:20, 20), lat = rep(1:20, each = 20),
  square = sqrt(long^2 + lat^2)
)
ggplot(fyc, aes(long, lat)) +
  geom_tile(aes(fill = square)) +
  scale_fill_distiller(
    type = "seq",
    direction = 1
  )
```

### `scale_fill_grey()`：
```{r}
n + scale_fill_grey(start = 0.2, end = 0.8, na.value = "red")
```


```{r}
o <- c + geom_dotplot(aes(fill = ..x..))
```

### `scale_fill_distiller()`：
```{r, message=FALSE}
o + scale_fill_distiller(palette = "Blues")
```

### `scale_fill_gradient()`：
```{r, message=FALSE}
o + scale_fill_gradient(low = "red", high = "yellow")
```

### `scale_fill_gradient2()`：
```{r, message=FALSE}
o + scale_fill_gradient2(
  low = "red", high = "blue",mid = "white", midpoint = 25
)
```

### `scale_fill_gradientn()`：
```{r, message=FALSE}
o + scale_fill_gradientn(colours = topo.colors(6))
```


```{r}
p <- e + geom_point(aes(shape = fl, size = cyl))
```

### `scale_shape_manual()`：
```{r}
p + scale_shape_manual(values = c(3:7))
```

### `scale_radius()`：
```{r}
p + scale_radius(range = c(1, 6))
```

### `scale_size_area()`：
```{r}
p + scale_size_area(max_size = 6)
```

